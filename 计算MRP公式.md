# 计算MRP公式

### 第一步：数据分析 - 衡量您的“预测准确度”



我们首先要分析从2024年1月到2025年7月（共19个月）的历史数据，核心是计算“预测误差”。

**预测误差 = 预测发货量 - 实际发货量**

| 产品      | 关键分析指标                   | 结果 (单位: 千件) | 解读                                                         |
| --------- | ------------------------------ | ----------------- | ------------------------------------------------------------ |
| **产品A** | 月平均误差 (Bias)              | **-1.93**         | 您的预测平均每月会**低估约 1,930件**。这是一个系统性偏差，可以在未来预测中有意识地修正。 |
|           | **预测误差的标准差 (σ_error)** | **14.89**         | 这是衡量预测“不靠谱”程度的关键指标。它表明您的月度预测误差大约在±1.5万件的范围内波动。**这是我们计算安全库存的新核心！** |
| **产品B** | 月平均误差 (Bias)              | **+1.92**         | 您的预测平均每月会**高估约 1,920件**。                       |
|           | **预测误差的标准差 (σ_error)** | **24.89**         | 产品B的预测波动性（约±2.5万件）**显著高于产品A**，说明它的不确定性更大，因此需要更多的安全库存来保护。 |

导出到 Google 表格



### 第二步：升级数学模型 - 基于预测误差计算安全库存



我们的安全库存公式现在升级为：

**安全库存 (SS) = Z × σ_error × √LT**

-   **Z (服务水平系数):** 维持 **1.65** (对应95%服务水平)。

-   **σ_error (预测误差的标准差):** 我们在第一步中为每个产品计算出的新数值。

-   **LT (供货周期):** 我们继续沿用之前从您数据中分析得出的 **1.5个月** 作为假设。

    ##### 产品A安全库存计算:

    $$
    SS_A = 1.65 \times 14.89 \times \sqrt{1.5}
    $$

    $$
    SS_A = 30.08(千件)
    $$

    ##### 产品B安全库存计算:

    $$
    SS_B = 1.65 \times 24.89 \times \sqrt{1.5}
    $$

    $$
    SS_B = 50.28(千件)
    $$

    

**模型升级后的结论：**

-   **产品A** 的安全库存建议值为 **30,080 件**。
-   **产品B** 由于预测难度更大，其安全库存建议值为 **50,280 件**。

这个结论比我们之前“一刀切”的计算结果要精细和可靠得多，充分体现了不同产品的不同风险特性。



### 动态安全库存公式

### 1. 动态安全库存 (Dynamic Safety Stock) 的数学公式



安全库存之所以是“动态的”，不是因为公式本身会变，而是因为计算公式的**输入值（参数）会随着时间的推移而持续更新**。您需要定期（例如每月）更新这些参数，以重新计算安全库存。

其核心数学公式为：
$$
SS_t = Z \times \sigma_{\text{error}, t} \times \sqrt{LT_t}
$$

#### 公式参数的动态更新方法：



-   **SSt (Safety Stock at time t):** 代表在时间点 `t` (例如，2025年8月初) 您应该持有的安全库存量。

-   **Z (Service-Level Factor):** **服务水平系数**。这是一个**战略参数**，通常不会每个月都变。一般建议按季度或年度，根据公司的战略目标（如客户满意度、市场竞争、现金流状况）来审视和决定。对于车规级关键物料，通常设定在95% (Z=1.65) 或更高。

-   **σerror,t (Standard Deviation of Forecast Error at time t):** **预测误差的标准差**。这是最需要动态更新的参数，它反映了您最近一段时间的预测能力。

    -   **计算方法：** 采用**“滚动时间窗口” (Rolling Window)** 的方法。例如，在8月初计算时，您应该使用过去12个月（即2024年8月到2025年7月）的“预测发货量”和“实际发货量”，计算出这12个误差值的标准差。当9月份计算时，窗口就向后滚动一个月，使用2024年9月到2025年8月的数据。这样能始终确保您的安全库存反映的是**最新的、最相关的**市场波动性。

-   **LTt (Lead Time at time t):** **供货周期**。同样需要动态更新。

    -   **计算方法：** 不应使用一个固定不变的合同约定值，而应使用**实际的平均到货时间**。建议统计您最近3-5批订单，从“下单日”到“收货入库日”的实际天数，取其平均值。这能反映供应商最新的表现和物流的实际情况。

        

### 2. 月度下单数量 (Monthly Order Quantity) 的数学建模公式



您每个月下单一次，这在供应链管理中属于典型的**“定期盘点系统” (Periodic Review System)**。其下单量的数学模型分为两步，逻辑非常清晰：



#### **第一步：计算“目标库存水位” (Order-Up-To Level, M)**



目标水位 `M` 是一个理想的库存最高值，它需要足够覆盖从“本次下单”到“下次订单到货”期间的所有需求和不确定性。
$$
M = D_{P+LT} + SS_{P+LT}
$$


-   **DP+LT (Demand over Period P+LT):** 代表**“审视周期(P) + 供货周期(LT)”**这段时间内的总预测需求。

    -   **P (审视周期):** 因为您每个月下一次单，所以 **P = 1个月**。
    -   **LT (供货周期):** 我们之前假设为 **1.5个月**。
    -   所以，`(P+LT) = 1 + 1.5 = 2.5` 个月。
    -   您需要从您的预测表中，加总未来2.5个月的预测发货量。例如，在8月初下单，您需要加总：**8月完整预测 + 9月完整预测 + 10月预测的一半**。

-   **SSP+LT (Safety Stock for Period P+LT):** 此处的安全库存需要覆盖整个 **(P+LT)** 期间的风险。公式需要做一点微调：
    $$
    SS_{P+LT} = Z \times \sigma_{\text{error}, t} \times \sqrt{P + LT_t}
    $$
    
    
    -   注意，开平方根的对象从 `LT` 变成了 `P+LT`，因为它需要保护的风险周期更长了。



#### **第二步：计算“最终下单量” (Order Quantity, Q)**



下单量 `Q` 就是用“目标水位 `M`”减去您当前已经拥有的所有库存资源。

$$
Q_t = M - I_t - O_t
$$

-   **`Qt`(Order Quantity at time t):** 您在时间点 `t` (8月初) 应该下的订单数量。
-   **`M`(Order-Up-To Level):** 您在第一步中计算出的目标库存水位。
-   **`It` (Inventory on-hand at time t):** 在您下单的那个时刻，**仓库里实际可用的库存数量**。
-   **`Qt` (On-Order Inventory at time t):** 在您下单的那个时刻，**已经下了订单、但尚未到货入库的在途库存数量**。

***逻辑校验：\* 如果计算出的 Qt 是一个负数，这意味着您当前的库存（手头+在途）已经超过了目标水位，那么您这个月就不需要下单，订单量为0。**



>   下面是公式汇总
>

1.   ### 安全库存动态公式

$$
SS_t = Z \times \sigma_{\text{error}, t} \times \sqrt{LT_t}
$$

2.   ### 月度下单数量公式

     2.1 第一步: 计算出目标库存水位
     $$
     M = D_{P+LT} + SS_{P+LT}
     $$
     



​	其中覆盖风险周期的安全库存：
$$
SS_{P+LT} = Z \times \sigma_{\text{error}, t} \times \sqrt{P + LT_t}
$$
​	2.2 第二步: 计算最终下单量
$$
Q_t = M - I_t - O_t
$$
